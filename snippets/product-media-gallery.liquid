<div id="ProductGalleryWrapper">

  <!-- Main Swiper -->
  <div class="swiper product-main-swiper">
    <div class="swiper-wrapper">
      {% for media in product.media %}
        <div class="swiper-slide" data-media-id="{{ media.id }}">
          {% render 'product-thumbnail',
            media: media,
            media_count: product.media.size,
            position: forloop.index,
            desktop_layout: section.settings.gallery_layout,
            mobile_layout: section.settings.mobile_thumbnails,
            loop: section.settings.enable_video_looping,
            modal_id: section.id,
            xr_button: true,
            media_width: media_width,
            media_fit: section.settings.media_fit,
            constrain_to_viewport: section.settings.constrain_to_viewport,
            lazy_load: true
          %}
        </div>
      {% endfor %}
    </div>
    <!-- Arrows -->
    <div class="swiper-button-next"></div>
    <div class="swiper-button-prev"></div>
  </div>

  <!-- Thumbnail Swiper -->
  <div class="swiper product-thumb-swiper">
    <div class="swiper-wrapper">
      {% for media in product.media %}
        <div class="swiper-slide" data-media-id="{{ media.id }}">
          <img
            src="{{ media.preview_image | image_url: width: 80 }}"
            alt="{{ media.alt | escape }}"
            loading="lazy"
          />
        </div>
      {% endfor %}
    </div>
  </div>

</div>


<script>
  document.addEventListener('DOMContentLoaded', function () {
  const thumbSwiper = new Swiper('.product-thumb-swiper', {
    spaceBetween: 10,
    slidesPerView: 4,
    freeMode: true,
    watchSlidesProgress: true,
    breakpoints: {
      768: {
        direction: 'vertical'
      }
    }
  });

  const mainSwiper = new Swiper('.product-main-swiper', {
    spaceBetween: 10,
    navigation: {
      nextEl: '.swiper-button-next',
      prevEl: '.swiper-button-prev'
    },
    thumbs: {
      swiper: thumbSwiper
    }
  });

  // Scroll to variant's media
  const productForm = document.querySelector('form[action^="/cart"]');
  if (productForm && window.productData) {
    productForm.addEventListener('change', function () {
      const selectedVariantId = productForm.querySelector('[name="id"]').value;
      const variant = window.productData.variants.find(v => v.id == selectedVariantId);
      const mediaId = variant?.featured_media?.id;
      if (mediaId) {
        const slide = document.querySelector(`.product-main-swiper .swiper-slide[data-media-id="${mediaId}"]`);
        if (slide) {
          const slideIndex = [...slide.parentNode.children].indexOf(slide);
          mainSwiper.slideTo(slideIndex);
        }
      }
    });
  }
});

</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<script defer src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
{{ 'swiper-init.js' | asset_url | script_tag }}

<style>
  .product-main-swiper {
  width: 100%;
  margin-bottom: 1rem;
}
.product-main-swiper .swiper-slide {
  display: flex;
  justify-content: center;
}
.product-thumb-swiper .swiper-slide {
  width: 80px;
  height: auto;
  opacity: 0.5;
  cursor: pointer;
}
.product-thumb-swiper .swiper-slide-thumb-active {
  opacity: 1;
}
.swiper-button-next,
.swiper-button-prev {
  color: #000;
}

</style>
